generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String     @id @default(auto()) @map("_id") @db.ObjectId
  username      String     @unique
  firstName     String
  lastName      String
  email         String     @unique
  password      String
  isCapper      Boolean?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  subscriptions Capper[]   @relation("UserSubscriptions", fields: [subscribedToIds], references: [id])
  subscribedToIds String[] @db.ObjectId
  capperProfile Capper?
  imageUrl      String?
  stripeConnectId        String?   // For Cappers' Stripe Connect accounts
  stripeConnectOnboarded Boolean   @default(false)
  payoutEnabled         Boolean   @default(false)
  stripeConnectCountry  String?   // Add this field
}


// The cappers should only refer to the username from the user model. 
model Capper {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  userId        String         @unique @db.ObjectId
  user          User            @relation(fields: [userId], references: [id])
  bio           String?
  title         String?         // Professional title
  imageUrl      String?         // Profile image
  socialLinks   Json?           // Store social links as JSON
  tags          String[]        // Keep existing tags
  subscribers   User[]          @relation("UserSubscriptions", fields: [subscriberIds], references: [id])
  subscriberIds String[]       @db.ObjectId
  posts         CapperPost[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  subscriptions Subscription[]
}
  
// TODO: Add SEO friendly fields. 

// TODO: Add right parameters for capper post 
model CapperPost {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  title         String
  content       String
  imageUrl      String?
  tags          String[]
  bets          String[]
  odds          String[]
  capperId      String   @db.ObjectId
  productId     String   // Add this field to link post to a specific product
  capper        Capper   @relation(fields: [capperId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  likes         Int      @default(0)
  comments      Int      @default(0)

  @@index([capperId])
  @@index([productId])
}

model Subscription {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  userId        String    @db.ObjectId
  capperId      String    @db.ObjectId
  productId     String    // Add this for Stripe product ID
  priceId       String    // Add this for Stripe price ID
  status        String    @default("active")
  subscribedAt  DateTime  @default(now())
  cancelledAt   DateTime?
  capper        Capper    @relation(fields: [capperId], references: [id])
  stripeSubscriptionId String?  // Add this for Stripe subscription ID

  @@index([userId])
  @@index([capperId])
  @@index([productId])
}
  